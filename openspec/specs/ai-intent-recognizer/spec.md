# AI Intent Recognizer Specification

## Requirements

### Requirement: æ„å›¾è¯†åˆ«

ç³»ç»Ÿ SHALL å°†ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€è¾“å…¥è§£æžä¸ºç»“æž„åŒ–çš„æ„å›¾å’Œå‚æ•°ã€‚

#### Scenario: è¯†åˆ«åˆ›å»ºæ–‡ç« æ„å›¾
- **WHEN** ç”¨æˆ·è¾“å…¥ "åˆ›å»ºä¸€ç¯‡å…³äºŽ WebSocket çš„æ–‡ç« "
- **THEN** ç³»ç»Ÿè¯†åˆ« intent ä¸º `create_article`ï¼Œparams ä¸º `{ topic: "WebSocket" }`

#### Scenario: è¯†åˆ«å‘å¸ƒæ„å›¾
- **WHEN** ç”¨æˆ·è¾“å…¥ "å‘å¸ƒ"
- **THEN** ç³»ç»Ÿè¯†åˆ« intent ä¸º `publish_article`ï¼Œparams ä¸º `{}`

#### Scenario: è¯†åˆ«éƒ¨ç½²æ„å›¾
- **WHEN** ç”¨æˆ·è¾“å…¥ "éƒ¨ç½²åˆ°æœåŠ¡å™¨"
- **THEN** ç³»ç»Ÿè¯†åˆ« intent ä¸º `deploy`ï¼Œparams ä¸º `{}`

#### Scenario: è¯†åˆ«å¸®åŠ©æ„å›¾
- **WHEN** ç”¨æˆ·è¾“å…¥ "è¿™ä¸ªå·¥å…·æ€Žä¹ˆéƒ¨ç½²ï¼Ÿ"
- **THEN** ç³»ç»Ÿè¯†åˆ« intent ä¸º `help`ï¼Œparams ä¸º `{ question: "æ€Žä¹ˆéƒ¨ç½²" }`

#### Scenario: è¯†åˆ«æœªçŸ¥æ„å›¾
- **WHEN** ç”¨æˆ·è¾“å…¥è¶…å‡ºç³»ç»Ÿèƒ½åŠ›èŒƒå›´çš„è¯·æ±‚ï¼ˆå¦‚ "å¸®æˆ‘ä¹°ä¸ªå’–å•¡"ï¼‰
- **THEN** ç³»ç»Ÿè¯†åˆ« intent ä¸º `unknown`ï¼Œå¹¶è¿”å›žæç¤ºä¿¡æ¯

#### Scenario: è¯†åˆ«å¯åŠ¨å¼€å‘æœåŠ¡å™¨æ„å›¾
- **WHEN** ç”¨æˆ·è¾“å…¥ "å¯åŠ¨å¼€å‘æœåŠ¡å™¨" æˆ– "æœ¬åœ°é¢„è§ˆ"
- **THEN** ç³»ç»Ÿè¯†åˆ« intent ä¸º `start_dev`ï¼Œparams ä¸º `{}`

#### Scenario: è¯†åˆ«æž„å»ºæ„å›¾
- **WHEN** ç”¨æˆ·è¾“å…¥ "æž„å»ºé¡¹ç›®" æˆ– "æ‰“åŒ…"
- **THEN** ç³»ç»Ÿè¯†åˆ« intent ä¸º `build`ï¼Œparams ä¸º `{}`

#### Scenario: è¯†åˆ«æ£€æŸ¥çŠ¶æ€æ„å›¾
- **WHEN** ç”¨æˆ·è¾“å…¥ "æ£€æŸ¥çŠ¶æ€" æˆ– "å½“å‰ä»€ä¹ˆæƒ…å†µ"
- **THEN** ç³»ç»Ÿè¯†åˆ« intent ä¸º `check_status`ï¼Œparams ä¸º `{}`

#### Scenario: è¯†åˆ«éƒ¨ç½²æ„å›¾
- **WHEN** ç”¨æˆ·è¾“å…¥ "éƒ¨ç½²åˆ°æœåŠ¡å™¨" æˆ– "å‘å¸ƒåˆ°çº¿ä¸Š"
- **THEN** ç³»ç»Ÿè¯†åˆ« intent ä¸º `deploy`ï¼Œparams ä¸º `{}`

### Requirement: å‚æ•°ç¼ºå¤±æ£€æµ‹

ç³»ç»Ÿ SHALL æ£€æµ‹å¿…éœ€å‚æ•°æ˜¯å¦ç¼ºå¤±ï¼Œå¹¶ç”Ÿæˆè¿½é—®æç¤ºã€‚

#### Scenario: æ£€æµ‹ä¸»é¢˜ç¼ºå¤±
- **WHEN** ç”¨æˆ·è¾“å…¥ "åˆ›å»ºæ–‡ç« " ä½†æœªæä¾›ä¸»é¢˜
- **THEN** ç³»ç»Ÿè¿”å›ž missingParams åŒ…å« `topic`ï¼Œå¹¶ç”Ÿæˆè¿½é—® "è¯·å‘Šè¯‰æˆ‘æ–‡ç« çš„ä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ"

#### Scenario: æ£€æµ‹ä¸Šä¸‹æ–‡ç¼ºå¤±
- **WHEN** ç”¨æˆ·è¾“å…¥ "å‘å¸ƒ" ä½†æ²¡æœ‰æœªå‘å¸ƒçš„æ–‡ç« å˜æ›´
- **THEN** ç³»ç»Ÿè¿”å›ž followUp å»ºè®® "æ²¡æœ‰æ‰¾åˆ°æœªå‘å¸ƒçš„æ–‡ç« å˜æ›´ï¼Œä½ æ˜¯è¦éƒ¨ç½²å—ï¼Ÿ"

### Requirement: AI å®¢æˆ·ç«¯é…ç½®

ç³»ç»Ÿ SHALL å¤ç”¨é¡¹ç›®çŽ°æœ‰çš„ OpenAI å…¼å®¹ API é…ç½®ã€‚

#### Scenario: ä½¿ç”¨çŽ¯å¢ƒå˜é‡é…ç½®
- **WHEN** ç³»ç»Ÿåˆå§‹åŒ– AI å®¢æˆ·ç«¯
- **THEN** ç³»ç»Ÿä»Ž `.env` è¯»å– `OPENAI_API_KEY` å’Œ `OPENAI_BASE_URL`

#### Scenario: æ”¯æŒå¤šç§ AI æä¾›å•†
- **WHEN** `OPENAI_BASE_URL` æŒ‡å‘ä¸åŒçš„æœåŠ¡å•†ï¼ˆOpenAI/Azure/DeepSeek/Ollamaï¼‰
- **THEN** ç³»ç»Ÿèƒ½å¤Ÿæ­£å¸¸è°ƒç”¨å¯¹åº”çš„ API

### Requirement: çŸ¥è¯†åº“æ³¨å…¥

ç³»ç»Ÿ SHALL åœ¨è°ƒç”¨ AI æ—¶æ³¨å…¥çŸ¥è¯†åº“ä¸Šä¸‹æ–‡ï¼Œç¡®ä¿ AI åŸºäºŽå®žé™…èƒ½åŠ›å›žç­”ã€‚

#### Scenario: æ³¨å…¥åŠ¨æ€çŸ¥è¯†
- **WHEN** è°ƒç”¨æ„å›¾è¯†åˆ« API
- **THEN** System Prompt åŒ…å«ä»Ž Workflow å®šä¹‰æå–çš„æ„å›¾åˆ—è¡¨å’Œå‚æ•°è¯´æ˜Ž

#### Scenario: æ³¨å…¥é™æ€çŸ¥è¯†
- **WHEN** è°ƒç”¨æ„å›¾è¯†åˆ« API
- **THEN** System Prompt åŒ…å«é™æ€çŸ¥è¯†ï¼ˆéƒ¨ç½²è¯´æ˜Žã€å¸¸è§é—®é¢˜ç­‰ï¼‰

### Requirement: é”™è¯¯å¤„ç†

ç³»ç»Ÿ SHALL ä¼˜é›…å¤„ç† AI æœåŠ¡è°ƒç”¨å¤±è´¥çš„æƒ…å†µã€‚

#### Scenario: API è¶…æ—¶
- **WHEN** AI API è°ƒç”¨è¶…æ—¶ï¼ˆè¶…è¿‡ 30 ç§’æœªå“åº”ï¼‰
- **THEN** ç³»ç»Ÿæ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º "AI æœåŠ¡å“åº”è¶…æ—¶ï¼Œè¯·ç¨åŽé‡è¯•"
- **THEN** ç³»ç»Ÿä¸å´©æºƒï¼Œç”¨æˆ·å¯é‡æ–°è¾“å…¥

#### Scenario: API è®¤è¯å¤±è´¥
- **WHEN** `OPENAI_API_KEY` æœªé…ç½®æˆ–æ— æ•ˆ
- **THEN** ç³»ç»Ÿæ˜¾ç¤ºé”™è¯¯æç¤º "è¯·æ£€æŸ¥ OPENAI_API_KEY çŽ¯å¢ƒå˜é‡é…ç½®"
- **THEN** ç³»ç»Ÿå»ºè®®ç”¨æˆ·ä½¿ç”¨å‘½ä»¤è¡Œæ¨¡å¼

#### Scenario: API æœåŠ¡ä¸å¯ç”¨
- **WHEN** AI æœåŠ¡è¿”å›ž 5xx é”™è¯¯æˆ–ç½‘ç»œä¸å¯è¾¾
- **THEN** ç³»ç»Ÿæ˜¾ç¤ºé”™è¯¯æç¤º "AI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨"
- **THEN** ç³»ç»Ÿå»ºè®®ç”¨æˆ·ä½¿ç”¨å‘½ä»¤è¡Œæ¨¡å¼ç»•è¿‡ AI

#### Scenario: å“åº”æ ¼å¼é”™è¯¯
- **WHEN** AI è¿”å›žçš„å†…å®¹æ— æ³•è§£æžä¸ºç»“æž„åŒ–æ„å›¾
- **THEN** ç³»ç»Ÿæç¤ºç”¨æˆ·æ¢ä¸€ç§è¡¨è¾¾æ–¹å¼
- **THEN** ç³»ç»Ÿè®°å½•åŽŸå§‹å“åº”ç”¨äºŽè°ƒè¯•

### Requirement: ç½®ä¿¡åº¦é˜ˆå€¼åˆ¤æ–­

ç³»ç»Ÿ SHALL æ ¹æ®ç½®ä¿¡åº¦å†³å®šæ˜¯å¦éœ€è¦ç”¨æˆ·ç¡®è®¤ã€‚

#### Scenario: é«˜ç½®ä¿¡åº¦ç›´æŽ¥æ‰§è¡Œ
- **WHEN** AI è¿”å›žçš„ confidence >= 0.7
- **THEN** ç³»ç»Ÿç›´æŽ¥æ‰§è¡Œå¯¹åº”çš„ Workflow

#### Scenario: ä½Žç½®ä¿¡åº¦è¯·æ±‚ç¡®è®¤
- **WHEN** AI è¿”å›žçš„ confidence < 0.7
- **THEN** ç³»ç»Ÿæ˜¾ç¤º "æˆ‘ä¸å¤ªç¡®å®šæ‚¨çš„æ„å›¾ï¼Œæ‚¨æ˜¯æƒ³è¦æ‰§è¡Œ [X] å—ï¼Ÿ"
- **THEN** ç³»ç»Ÿç­‰å¾…ç”¨æˆ·ç¡®è®¤ï¼ˆæ˜¯/å¦ï¼‰

#### Scenario: ä½Žç½®ä¿¡åº¦ä¸”å¤šå€™é€‰
- **WHEN** AI è¿”å›žçš„ confidence < 0.7 ä¸”æœ‰å¤šä¸ªå¯èƒ½æ„å›¾
- **THEN** ç³»ç»Ÿæ˜¾ç¤ºå€™é€‰åˆ—è¡¨ä¾›ç”¨æˆ·é€‰æ‹©

### Requirement: AI å“åº”è§£æžå®¹é”™

ç³»ç»Ÿ SHALL å®¹é”™å¤„ç† AI è¿”å›žçš„éžæ ‡å‡† JSONã€‚

#### Scenario: æå– JSON ä»£ç å—
- **WHEN** AI è¿”å›žçš„å†…å®¹åŒ…å«åœ¨ ```json ``` ä»£ç å—ä¸­
- **THEN** ç³»ç»Ÿè‡ªåŠ¨æå–ä»£ç å—ä¸­çš„ JSON å†…å®¹

#### Scenario: å¤„ç† Markdown æ ¼å¼
- **WHEN** AI è¿”å›žçš„å†…å®¹åŒ…å«é¢å¤–çš„ Markdown æ ¼å¼
- **THEN** ç³»ç»Ÿæ¸…ç†æ ¼å¼å¹¶è§£æž JSON

#### Scenario: è§£æžå¤±è´¥é™çº§
- **WHEN** AI è¿”å›žçš„å†…å®¹æ— æ³•è§£æžä¸º JSON
- **THEN** ç³»ç»Ÿè®°å½•åŽŸå§‹å“åº”ç”¨äºŽè°ƒè¯•
- **THEN** ç³»ç»Ÿæç¤ºç”¨æˆ· "æ— æ³•ç†è§£ AI çš„å“åº”ï¼Œè¯·æ¢ä¸€ç§è¡¨è¾¾æ–¹å¼"

### Requirement: è¶…æ—¶æŽ§åˆ¶

ç³»ç»Ÿ SHALL é™åˆ¶ AI è°ƒç”¨çš„ç­‰å¾…æ—¶é—´ã€‚

#### Scenario: 5 ç§’è¶…æ—¶
- **WHEN** AI API è°ƒç”¨è¶…è¿‡ 5 ç§’æœªå“åº”
- **THEN** ç³»ç»Ÿå–æ¶ˆè¯·æ±‚
- **THEN** ç³»ç»Ÿæ˜¾ç¤º "AI æœåŠ¡å“åº”è¶…æ—¶ï¼Œè¯·ç¨åŽé‡è¯•"

#### Scenario: è¶…æ—¶åŽé‡è¯•
- **WHEN** AI è°ƒç”¨è¶…æ—¶
- **THEN** ç³»ç»Ÿå…è®¸ç”¨æˆ·é‡æ–°è¾“å…¥ç›¸åŒçš„æŒ‡ä»¤

### Requirement: åŠ è½½æç¤º

ç³»ç»Ÿ SHALL åœ¨ AI æ€è€ƒæ—¶æ˜¾ç¤ºåŠ è½½æç¤ºã€‚

#### Scenario: æ˜¾ç¤ºæ€è€ƒåŠ¨ç”»
- **WHEN** AI æ­£åœ¨å¤„ç†ç”¨æˆ·è¾“å…¥
- **THEN** ç³»ç»Ÿæ˜¾ç¤º "ðŸ¤” æ€è€ƒä¸­..." åŠ¨ç”»ï¼ˆå¯é€‰ï¼šä½¿ç”¨ spinnerï¼‰

#### Scenario: æ€è€ƒå®ŒæˆåŽéšè—
- **WHEN** AI å¤„ç†å®Œæˆ
- **THEN** ç³»ç»Ÿéšè—åŠ è½½æç¤ºå¹¶æ˜¾ç¤ºç»“æžœ

### Requirement: å¤šè½®å‚æ•°æ”¶é›†

ç³»ç»Ÿ SHALL æ”¯æŒé€šè¿‡å¯¹è¯æ–¹å¼æ”¶é›†ç¼ºå¤±çš„å¿…éœ€å‚æ•°ã€‚

#### Scenario: é€ä¸ªæ”¶é›†å‚æ•°
- **WHEN** ç”¨æˆ·è¾“å…¥ "åˆ›å»ºæ–‡ç« " ä½†ç¼ºå°‘ topic å‚æ•°
- **THEN** ç³»ç»Ÿæç¤º "ðŸ“ è¯·è¾“å…¥æ–‡ç« ä¸»é¢˜ï¼š"
- **THEN** ç”¨æˆ·è¾“å…¥åŽï¼Œç³»ç»Ÿè¡¥å……å‚æ•°å¹¶ç»§ç»­

#### Scenario: å‚æ•°éªŒè¯
- **WHEN** ç”¨æˆ·æä¾›çš„å‚æ•°ä¸ç¬¦åˆé¢„æœŸæ ¼å¼
- **THEN** ç³»ç»Ÿæç¤º "å‚æ•°æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°è¾“å…¥ï¼š"

#### Scenario: å–æ¶ˆå‚æ•°æ”¶é›†
- **WHEN** ç”¨æˆ·åœ¨å‚æ•°æ”¶é›†è¿‡ç¨‹ä¸­è¾“å…¥ `cancel` æˆ– `å–æ¶ˆ`
- **THEN** ç³»ç»Ÿè¿”å›žè¾“å…¥æç¤ºï¼Œæ”¾å¼ƒå½“å‰æ“ä½œ
