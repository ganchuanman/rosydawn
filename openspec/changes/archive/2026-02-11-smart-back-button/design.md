## Context

当前 Rosydawn 博客系统中，返回按钮使用 `history.back()` 实现。这种方式在简单导航场景下有效，但在以下场景中会导致用户体验问题：

- 用户从标签详情页进入文章，然后通过"上一篇/下一篇"切换多篇文章后，点击返回会逐篇回退而非直接回到标签详情页
- 返回按钮文案固定，用户无法直观知道将返回到哪个页面

现有页面结构：
- **入口页面**（非叶子节点）：首页、文章列表页、标签列表页、标签详情页
- **叶子节点**：文章详情页

## Goals / Non-Goals

**Goals:**
- 返回按钮根据来源页面显示对应文案（如"返回文章列表"、"返回标签详情"）
- 无论在文章间如何切换，返回始终导航到最初进入文章的入口页面
- 统一返回按钮组件，减少代码重复
- 保持现有 Astro SSG 架构，不引入服务端状态

**Non-Goals:**
- 不追踪完整的浏览历史栈
- 不支持多级返回（仅支持一级返回到入口页面）
- 不改变页面的 URL 路径结构

## Decisions

### Decision 1: 来源信息传递机制

**选择**：URL Query Parameter

使用 `?from=<type>&ref=<path>` 格式传递来源信息：
- `from`: 来源类型标识（`home` | `blog-list` | `tag-list` | `tag-detail`）
- `ref`: 来源页面的完整路径（如 `/tags/vue`）

**替代方案考虑**：
| 方案 | 优点 | 缺点 |
|------|------|------|
| URL Query Parameter | 可复制分享、刷新后保留、无需 JS | URL 较长 |
| sessionStorage | URL 简洁 | 刷新后可能丢失、新标签页不继承 |
| URL Hash | 不触发页面重载 | 与文章内锚点冲突 |

**选择理由**：Query Parameter 在刷新、分享、浏览器前进后退时都能保持来源信息，符合 SSG 静态站点的特性。

### Decision 2: 来源类型定义

| 来源类型 | 标识值 | 默认返回路径 | 返回文案 |
|----------|--------|--------------|----------|
| 首页 | `home` | `/` | 返回首页 |
| 文章列表页 | `blog-list` | `ref` 参数值 | 返回文章列表 |
| 标签列表页 | `tag-list` | `/tags` | 返回标签列表 |
| 标签详情页 | `tag-detail` | `ref` 参数值 | 返回 #{tagName} |
| 无来源/未知 | - | `/` | 返回首页 |

### Decision 3: 组件实现方式

**选择**：服务端渲染 + 客户端增强

- 组件在服务端渲染默认状态（"返回首页"）
- 客户端 JS 读取 URL Query Parameter，更新文案和链接
- 这样即使 JS 加载失败，用户仍可返回首页

```
BackButton.astro
├── Props: fallbackHref, fallbackLabel
├── SSR: 渲染默认返回链接
└── Client Script: 读取 ?from&ref 更新 DOM
```

### Decision 4: 上一篇/下一篇来源传递

**选择**：在导航链接中保留当前来源参数

当用户点击"上一篇"或"下一篇"时，链接需要携带当前页面的来源信息：

```
原始链接: /blog/post-2
带来源链接: /blog/post-2?from=tag-detail&ref=/tags/vue
```

实现方式：客户端 JS 读取当前页面的来源参数，动态修改上一篇/下一篇链接的 href。

### Decision 5: 入口页面链接修改

各入口页面在生成文章链接时添加来源参数：

| 页面 | 链接示例 |
|------|----------|
| 首页 | `/blog/post-1?from=home` |
| 文章列表 (page 2) | `/blog/post-1?from=blog-list&ref=/blog/2` |
| 标签详情 | `/blog/post-1?from=tag-detail&ref=/tags/vue` |

## Risks / Trade-offs

**[风险] URL 变长** → 来源参数会使 URL 增加约 30-50 字符。可接受，不影响功能。

**[风险] 分享链接包含来源信息** → 他人打开分享链接时会看到分享者的来源页面作为返回目标。这是预期行为，返回到一个有意义的页面比使用 `history.back()` 更可预测。

**[风险] 无来源参数时的降级** → 直接访问文章详情页（无 `from` 参数）时，默认返回首页。用户体验可接受。

**[Trade-off] 客户端 JS 依赖** → 来源信息的读取和链接更新依赖客户端 JS。降级方案是返回首页，确保无 JS 时仍可导航。
