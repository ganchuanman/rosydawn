# Review Synthesis

## 1. TL;DR

本变更实现智能返回按钮功能，解决用户在文章间切换后无法直接返回最初入口页面的问题。通过 URL Query Parameter 传递来源信息，返回按钮将根据来源显示对应文案（如"返回 #vue"）并导航到正确页面，无论用户通过上一篇/下一篇切换了多少篇文章。

## 2. Core Changes

- **新增 `BackButton.astro` 组件**：统一的智能返回按钮，根据 URL 参数动态显示文案和导航目标
- **入口页面链接改造**：首页、文章列表、标签列表、标签详情页在生成链接时添加来源标识
- **上一篇/下一篇导航改造**：切换文章时保持原始来源参数不丢失
- **标签详情页返回按钮**：使用新组件，默认返回标签列表

## 3. Technical Highlights

| 决策 | 选择 | 理由 |
|------|------|------|
| **来源传递机制** | URL Query Parameter | 刷新、分享、前进后退都能保持来源，符合 SSG 特性 |
| **组件实现** | SSR + 客户端增强 | JS 失败时仍可返回首页，保证基本可用性 |
| **来源类型** | 4 种枚举值 | `home`、`blog-list`、`tag-list`、`tag-detail`，覆盖所有入口场景 |

**Trade-off**：URL 会变长（约 30-50 字符），但这是为了保持来源信息在各种场景下不丢失的必要代价。

## 4. Quality Assurance Overview

测试覆盖 **24 个用例**，主要验证：

| 测试类别 | 用例数 | 关键验证点 |
|----------|--------|------------|
| 返回按钮文案/导航 | 7 | 各来源类型正确显示文案并导航 |
| 链接格式 | 5 | 入口页面生成正确的带参数链接 |
| 上一篇/下一篇 | 3 | 切换文章时来源参数保持不变 |
| 边缘情况 | 9 | 无来源、JS 禁用、页面刷新、未知 from 值 |

**重点测试场景**：从标签详情页进入文章 → 连续切换多篇 → 验证返回按钮始终指向原标签页

## 5. Impact & Risks

- **BREAKING CHANGES**: 无
- **受影响文件**:
  - `src/components/BackButton.astro` (新增)
  - `src/pages/index.astro`
  - `src/pages/blog/[...page].astro`
  - `src/pages/blog/[...slug].astro`
  - `src/pages/tags/index.astro`
  - `src/pages/tags/[tag].astro`

- **风险与缓解**:
  | 风险 | 缓解措施 |
  |------|----------|
  | 分享链接包含来源信息 | 预期行为，返回到有意义的页面比 `history.back()` 更可预测 |
  | JS 加载失败 | SSR 默认渲染"返回首页"，确保基本导航可用 |
  | 未知 from 值 | 降级为返回首页 |

## 6. Review Focus

- [ ] **@PM**: 来源类型的文案是否符合用户预期？（"返回 #vue" vs "返回标签详情"）
- [ ] **@Tech Lead**: URL Query Parameter 方案是否有更好的替代？
- [ ] **@QA**: TC-19（多次切换文章后来源保持）是否需要增加更多边界条件？
- [ ] **@All**: 分享链接包含来源信息的行为是否可接受？
