---
interface Props {
  fallbackHref?: string;
  fallbackLabel?: string;
}

const { fallbackHref = '/', fallbackLabel = '返回首页' } = Astro.props;
---

<a href={fallbackHref} class="back-link" data-back-button>
  <span class="back-arrow">←</span>
  <span class="back-label">{fallbackLabel}</span>
</a>

<script>
  document.addEventListener('astro:page-load', () => {
    const backButtons = document.querySelectorAll('[data-back-button]');

    backButtons.forEach((button) => {
      const url = new URL(window.location.href);
      const from = url.searchParams.get('from');
      const ref = url.searchParams.get('ref');

      if (!from) return;

      const labelEl = button.querySelector('.back-label');
      if (!labelEl) return;

      let targetHref = '/';
      let targetLabel = '返回首页';

      switch (from) {
        case 'home':
          targetHref = '/';
          targetLabel = '返回首页';
          break;
        case 'blog-list':
          targetHref = ref || '/';
          targetLabel = '返回文章列表';
          break;
        case 'tag-list':
          targetHref = '/tags';
          targetLabel = '返回标签列表';
          break;
        case 'tag-detail':
          targetHref = ref || '/tags';
          // 从 ref 中提取标签名，如 /tags/vue -> vue
          const tagName = ref ? ref.split('/').pop() : '';
          targetLabel = tagName ? `返回 #${tagName}` : '返回标签详情';
          break;
        default:
          // 未知类型，使用默认值
          break;
      }

      button.setAttribute('href', targetHref);
      labelEl.textContent = targetLabel;
    });
  });
</script>

<style>
  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--text-muted);
    text-decoration: none;
    margin-bottom: 1.5rem;
    transition: color 0.2s;
  }

  .back-link:hover {
    color: var(--accent);
    text-decoration: none;
  }

  .back-arrow {
    transition: transform 0.2s;
  }

  .back-link:hover .back-arrow {
    transform: translateX(-4px);
  }
</style>
